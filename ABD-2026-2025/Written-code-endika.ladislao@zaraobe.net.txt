ColumnDefinition.cs (48) : return Encode(Name) + Delimiter + Type;
ColumnDefinition.cs (55) : if (string.IsNullOrEmpty(value)) return null;
ColumnDefinition.cs (57) : string[] parts = value.Split(Delimiter, 2);
ColumnDefinition.cs (59) : if (parts.Length != 2) return null;
ColumnDefinition.cs (61) : if (!Enum.TryParse<DataType>(parts[1], out var type)) return null;
ColumnDefinition.cs (63) : return new ColumnDefinition(type, Decode(parts[0]));
Database.cs (86) : if (TableByName(tableName) != null)
Database.cs (87) : {
Database.cs (88) : LastErrorMessage = Constants.TableAlreadyExistsError;
Database.cs (89) : return false;
Database.cs (90) : }
Database.cs (92) : if (ColumnDefinition.Count == 0)
Database.cs (93) : {
Database.cs (94) : LastErrorMessage = Constants.DatabaseCreatedWithoutColumnsError;
Database.cs (96) : }
Database.cs (98) : Table newTable = new(tableName, ColumnDefinition);
Database.cs (99) : Tables.Add(newTable);
Database.cs (101) : LastErrorMessage = Constants.CreateTableSuccess;
Database.cs (102) : return true;
Database.cs (147) : LastErrorMessage = Constants.ColumnCountsDontMatch;
Database.cs (149) : }
Database.cs (159) : Table table= TableByName(tableName);
Database.cs (160) : if (table == null)
Database.cs (161) : {
Database.cs (162) : LastErrorMessage = Constants.TableDoesNotExistError;
Database.cs (164) : }
Database.cs (165) : if(columns == null || columns.Count==0)
Database.cs (166) : {
Database.cs (167) : columns = new List<string>();
Database.cs (168) : for (int i=0; i<table.NumColumns(); i++)
Database.cs (169) : {
Database.cs (170) : columns.Add(table.GetColumn(i).Name);
Database.cs (171) : }
Database.cs (172) : }
Database.cs (173) : foreach (string col in columns)
Database.cs (174) : {
Database.cs (175) : if (table.ColumnIndexByName(col)==-1)
Database.cs (176) : {
Database.cs (177) : LastErrorMessage=Constants.ColumnDoesNotExistError;
Database.cs (178) : return null;
Database.cs (179) : }
Database.cs (180) : }
Database.cs (181) : Table result = table.Select(columns, condition);
Database.cs (182) : return result;
Database.cs (191) : // Check for table
Database.cs (192) : Table selectedTable = TableByName(tableName);
Database.cs (194) : if (selectedTable == null)
Database.cs (195) : {
Database.cs (196) : LastErrorMessage = Constants.TableDoesNotExistError;
Database.cs (198) : }
Database.cs (200) : // Check for column
Database.cs (201) : if (selectedTable.ColumnIndexByName(columnCondition.ColumnName) == -1)
Database.cs (202) : {
Database.cs (203) : LastErrorMessage = Constants.ColumnDoesNotExistError;
Database.cs (204) : return false;
Database.cs (205) : }
Database.cs (207) : // Final removal
Database.cs (208) : for (int i = selectedTable.NumRows() - 1; i >= 0; i--)
Database.cs (209) : {
Database.cs (210) : if (selectedTable.GetRow(i).IsTrue(columnCondition))
Database.cs (211) : {
Database.cs (212) : selectedTable.DeleteIthRow(i);
Database.cs (213) : }
Database.cs (214) : }
Database.cs (216) : return true;
Database.cs (245) : private const string tbl=".tbl";
Database.cs (246) : private const string Delimiter = "--";
Database.cs (254) : try
Database.cs (255) : {
Database.cs (256) : string path = Path.Combine(Directory.GetCurrentDirectory(), databaseName);
Database.cs (257) : Directory.CreateDirectory(databaseName);
Database.cs (258) : foreach (Table table in Tables)
Database.cs (259) : {
Database.cs (260) : string fileName = Path.Combine(path, table.Name + tbl);
Database.cs (261) : using (TextWriter writer = File.CreateText(fileName))
Database.cs (262) : {
Database.cs (263) : for (int i = 0; i < table.NumColumns(); i++)
Database.cs (264) : {
Database.cs (265) : writer.WriteLine(table.GetColumn(i).AsText().Replace("->", "\\->"));
Database.cs (266) : }
Database.cs (267) : writer.WriteLine(Delimiter);
Database.cs (268) : for (int i = 0; i < table.NumRows(); i++)
Database.cs (269) : {
Database.cs (270) : writer.WriteLine(table.GetRow(i).AsText().Replace(":", "\\:"));
Database.cs (271) : }
Database.cs (272) : }
Database.cs (273) : }
Database.cs (274) : return true;
Database.cs (275) : }
Database.cs (276) : catch (Exception ex)
Database.cs (277) : {
Database.cs (278) : LastErrorMessage = Constants.Error + ex.Message;
Database.cs (280) : }
Database.cs (290) : try
Database.cs (291) : {
Database.cs (292) : Database db = new Database(username, password);
Database.cs (293) : string path = Path.Combine(Directory.GetCurrentDirectory(), databaseName);
Database.cs (294) : if (!Directory.Exists(path)) {
Database.cs (295) : return null;
Database.cs (296) : }
Database.cs (297) : foreach (var filePath in Directory.GetFiles(path, "*"+tbl))
Database.cs (298) : {
Database.cs (299) : using (TextReader reader = File.OpenText(filePath))
Database.cs (300) : {
Database.cs (301) : List<ColumnDefinition> columns = new List<ColumnDefinition>();
Database.cs (302) : string line;
Database.cs (303) : while ((line = reader.ReadLine()) != Delimiter)
Database.cs (304) : {
Database.cs (305) : ColumnDefinition col=ColumnDefinition.Parse(line.Replace("\\->", "->"));
Database.cs (307) : if (columns != null)
Database.cs (308) : {
Database.cs (309) : columns.Add(col);
Database.cs (310) : }
Database.cs (311) : else {
Database.cs (312) : db.LastErrorMessage=Constants.SyntaxError;
Database.cs (313) : return null;
Database.cs (314) : }
Database.cs (315) : }
Database.cs (316) : string tableName = Path.GetFileNameWithoutExtension(filePath);
Database.cs (317) : db.CreateTable(tableName, columns);
Database.cs (318) : Table table = db.TableByName(tableName);
Database.cs (319) : if (table == null)
Database.cs (320) : {
Database.cs (321) : db.LastErrorMessage=Constants.TableDoesNotExistError;
Database.cs (322) : return null;
Database.cs (323) : }
Database.cs (324) : while ((line = reader.ReadLine()) != null)
Database.cs (325) : {
Database.cs (326) : Row row=Row.Parse(columns, line.Replace("\\:", ":"));
Database.cs (327) : db.TableByName(tableName).Insert(row.Values);
Database.cs (328) : }
Database.cs (330) : }
Database.cs (331) : }
Database.cs (333) : return db;
Database.cs (334) : }
Database.cs (335) : catch(Exception ex) {
Database.cs (336) : Database db=new Database(username, password);
Database.cs (337) : db.LastErrorMessage = ex.Message;
Database.cs (340) : }
Row.cs (20) : this.ColumnDefinitions = columnDefinitions;
Row.cs (21) : this.Values = values;
Row.cs (29) : for (int i = 0; i < this.ColumnDefinitions.Count; i++)
Row.cs (30) : {
Row.cs (31) : if (ColumnDefinitions[i].Name == columnName)
Row.cs (32) : {
Row.cs (33) : if (i<Values.Count)
Row.cs (34) : {
Row.cs (35) : Values[i] = value;
Row.cs (36) : }
Row.cs (37) : else
Row.cs (38) : {
Row.cs (39) : Values.Add(value);
Row.cs (40) : }
Row.cs (41) : return;
Row.cs (42) : }
Row.cs (43) : }
Row.cs (49) : for (int i = 0; i < this.ColumnDefinitions.Count; i++)
Row.cs (50) : {
Row.cs (51) : if (ColumnDefinitions[i].Name == columnName) {
Row.cs (52) : if (i<Values.Count)
Row.cs (53) : {
Row.cs (54) : return Values[i];
Row.cs (55) : }
Row.cs (56) : else
Row.cs (57) : {
Row.cs (58) : return null;
Row.cs (59) : }
Row.cs (61) : }
Row.cs (62) : }
Row.cs (71) : if (condition == null) return true;
Row.cs (74) : string rowValue = null;
Row.cs (76) : // Recorremos sin usar break
Row.cs (77) : for (int i = 0; i < ColumnDefinitions.Count; i++)
Row.cs (79) : // Comparamos el nombre de la columna directamente
Row.cs (80) : if (ColumnDefinitions[i].Name == condition.ColumnName)
Row.cs (82) : c = ColumnDefinitions[i];
Row.cs (83) : rowValue = Values[i];
Row.cs (87) : // Si no se encontr� la columna en esta fila
Row.cs (88) : if (c == null) return false;
Row.cs (90) : // Llamamos a la l�gica de la condici�n con el valor tal cual est�
Table.cs (115) : if (ColumnDefinitions.Count == 0 && Rows.Count == 0)
Table.cs (116) : {
Table.cs (117) : return "";
Table.cs (118) : }
Table.cs (119) : string result = "";
Table.cs (120) : if (ColumnDefinitions.Count > 0 || Rows.Count >0)
Table.cs (121) : {
Table.cs (122) : result += "[";
Table.cs (123) : for (int i = 0; i < ColumnDefinitions.Count; i++)
Table.cs (124) : {
Table.cs (125) : result += "'" + ColumnDefinitions[i].Name + "'";
Table.cs (127) : if (i < ColumnDefinitions.Count - 1)
Table.cs (128) : result += ",";
Table.cs (129) : }
Table.cs (130) : result += "]";
Table.cs (132) : }
Table.cs (134) : for (int i = 0; i < Rows.Count; i++)
Table.cs (135) : {
Table.cs (136) : result += "{";
Table.cs (137) : for (int j = 0; j < Rows[i].Values.Count; j++)
Table.cs (138) : {
Table.cs (139) : result += "'" + Rows[i].Values[j] + "'";
Table.cs (141) : if (j < Rows[i].Values.Count - 1)
Table.cs (142) : result += ",";
Table.cs (143) : }
Table.cs (144) : result += "}";
Table.cs (145) : }
Table.cs (147) : return result;
Table.cs (178) : if(condition == null) return;
Table.cs (179) : var index= RowIndicesWhereConditionIsTrue(condition);
Table.cs (180) : for (int i=index.Count -1; i>=0; i--)
Table.cs (181) : {
Table.cs (182) : Rows.RemoveAt(index[i]);
Table.cs (183) : }
Table.cs (200) : List<ColumnDefinition> selectedColumns = new List<ColumnDefinition>();
Table.cs (201) : foreach (string name in columnNames)
Table.cs (202) : {
Table.cs (203) : int index = ColumnIndexByName(name);
Table.cs (204) : if (index != -1)
Table.cs (205) : {
Table.cs (206) : selectedColumns.Add(ColumnDefinitions[index]);
Table.cs (207) : }
Table.cs (210) : Table result = new Table("Result", selectedColumns);
Table.cs (212) : foreach (var row in Rows)
Table.cs (213) : {
Table.cs (214) : if (condition == null || row.IsTrue(condition))
Table.cs (215) : {
Table.cs (216) : List<string> selectedValues = new List<string>();
Table.cs (218) : foreach (var name in columnNames)
Table.cs (219) : {
Table.cs (220) : int colIndex = ColumnIndexByName(name);
Table.cs (221) : if (colIndex != -1)
Table.cs (222) : {
Table.cs (223) : selectedValues.Add(row.Values[colIndex]);
Table.cs (224) : }
Table.cs (225) : }
Table.cs (227) : Row newRow = new Row(selectedColumns, selectedValues);
Table.cs (228) : result.AddRow(newRow);
Table.cs (229) : }
Table.cs (230) : }
Table.cs (232) : return result;
Table.cs (234) : }
Table.cs (241) : if (values == null || values.Count != ColumnDefinitions.Count)
Table.cs (242) : {
Table.cs (244) : }
Table.cs (251) : return true;
Table.cs (260) : if (condition == null) return false;
Table.cs (262) : if (setValues == null || setValues.Count == 0) return true;
Table.cs (264) : foreach (var row in Rows)
Table.cs (265) : {
Table.cs (266) : if (row.IsTrue(condition))
Table.cs (267) : {
Table.cs (268) : foreach (var sv in setValues)
Table.cs (269) : {
Table.cs (270) : row.SetValue(sv.ColumnName, sv.Value);
Table.cs (271) : }
Table.cs (272) : }
Table.cs (273) : }
Table.cs (274) : return true;
SetValue.cs (17) : ColumnName = column;
SetValue.cs (18) : Value = value;
